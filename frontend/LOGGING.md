# üìä Syst√®me de Logging Air Paradis Sentiment Analysis\n\nCe document explique comment utiliser le syst√®me de logging int√©gr√© dans l'application Air Paradis Sentiment Analysis.\n\n## üèóÔ∏è Architecture du Syst√®me\n\n```\nFrontend (Next.js)\n‚îú‚îÄ‚îÄ lib/logger.ts          # Utilitaire de logging principal\n‚îú‚îÄ‚îÄ app/api/logging/       # API route Next.js pour traitement des logs\n‚îî‚îÄ‚îÄ Backend (FastAPI)\n    ‚îî‚îÄ‚îÄ /api/logging       # Endpoint pour recevoir les logs du frontend\n        ‚îî‚îÄ‚îÄ Google Cloud   # Monitoring et alertes\n```\n\n## üîß Configuration\n\n### Variables d'environnement\n\n```bash\n# Configuration Google Cloud\nGOOGLE_CLOUD_PROJECT=air-paradis-sentiment\nGOOGLE_CLOUD_REGION=europe-west1\n\n# URL de l'API backend\nNEXT_PUBLIC_API_URL=https://air-paradis-sentiment-api-qxumenjqxq-ew.a.run.app\n\n# Configuration du monitoring\nNEXT_PUBLIC_MONITORING_ENABLED=true\n\n# Configuration des alertes\nALERT_THRESHOLD=3\nALERT_TIME_WINDOW_MINUTES=5\nALERT_EMAIL=berchet.thomas@gmail.com\n\n# Webhook optionnel pour les alertes\n# ALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL\n```\n\n## üìù Utilisation du Logger\n\n### Import\n\n```typescript\nimport logger from '@/lib/logger'\n```\n\n### Niveaux de Log\n\n#### 1. DEBUG\n```typescript\nlogger.debug('Message de debug', {\n  context: {\n    variable: 'valeur',\n    step: 'initialization'\n  }\n})\n```\n\n#### 2. INFO\n```typescript\nlogger.info('Op√©ration r√©ussie', {\n  operation: 'prediction',\n  duration: 1250,\n  result: 'positive'\n})\n```\n\n#### 3. WARNING\n```typescript\nlogger.warning('Situation inhabituelle d√©tect√©e', {\n  event_type: 'unusual_behavior',\n  context: {\n    user_id: 'user123',\n    action: 'multiple_requests'\n  }\n})\n```\n\n#### 4. ERROR\n```typescript\nlogger.error('Erreur lors de l\\'op√©ration', {\n  error: error.message,\n  stack: error.stack,\n  context: {\n    component: 'SentimentForm',\n    action: 'submit'\n  }\n})\n```\n\n#### 5. CRITICAL\n```typescript\nlogger.critical('Erreur critique syst√®me', {\n  error: 'Database connection failed',\n  context: {\n    service: 'api',\n    impact: 'high'\n  }\n})\n```\n\n### M√©thodes Sp√©cialis√©es\n\n#### Pr√©diction Correcte\n```typescript\nlogger.logCorrectPrediction(\n  'I love this airline!',    // texte\n  'positive',               // sentiment pr√©dit\n  0.87,                    // confiance\n  'req_123',               // ID de requ√™te (optionnel)\n  'user_456'               // ID utilisateur (optionnel)\n)\n```\n\n#### Pr√©diction Incorrecte (‚ö†Ô∏è D√©clenche une alerte)\n```typescript\nlogger.logIncorrectPrediction(\n  'This airline is terrible!',  // texte\n  'positive',                   // sentiment pr√©dit (incorrect)\n  'negative',                   // sentiment r√©el\n  0.65,                        // confiance\n  'req_124',                   // ID de requ√™te (optionnel)\n  'user_456'                   // ID utilisateur (optionnel)\n)\n```\n\n#### M√©triques de Performance\n```typescript\nlogger.logPerformanceMetrics({\n  responseTime: 1250,        // temps de r√©ponse total (ms)\n  modelLoadTime: 500,        // temps de chargement du mod√®le (ms)\n  predictionTime: 750        // temps de pr√©diction (ms)\n})\n```\n\n#### Erreurs d'API\n```typescript\nlogger.logApiError('/predict', error, {\n  method: 'POST',\n  statusCode: 500,\n  requestBody: { text: 'example' }\n})\n```\n\n#### Erreurs d'Interface\n```typescript\nlogger.logUIError('SentimentForm', error, {\n  component: 'SentimentForm',\n  props: { disabled: false },\n  state: { loading: true }\n})\n```\n\n#### Actions Utilisateur\n```typescript\nlogger.logUserAction('button-click', {\n  button: 'analyze',\n  text_length: 45,\n  timestamp: Date.now()\n})\n```\n\n#### D√©marrage de l'Application\n```typescript\nlogger.logAppStart() // Appel√© automatiquement au d√©marrage\n```\n\n## üö® Syst√®me d'Alertes\n\n### D√©clenchement des Alertes\n\nLes alertes sont d√©clench√©es automatiquement dans les cas suivants :\n\n1. **3 pr√©dictions incorrectes en 5 minutes**\n   - Utilise `logger.logIncorrectPrediction()`\n   - Envoie une alerte par email/webhook\n\n2. **Erreurs critiques**\n   - Utilise `logger.critical()`\n   - Alerte imm√©diate\n\n3. **Erreurs syst√®me r√©p√©t√©es**\n   - Utilise `logger.error()`\n   - Alerte si 3 erreurs en 5 minutes\n\n### Configuration des Alertes\n\n```typescript\n// Dans le fichier de configuration\nconst ALERT_THRESHOLD = 3           // Nombre d'erreurs\nconst ALERT_TIME_WINDOW_MS = 300000  // 5 minutes en millisecondes\n```\n\n### Types d'Alertes\n\n- **Console/Logs** : Toujours actifs\n- **Email** : Si `ALERT_EMAIL` configur√©\n- **Webhook** : Si `ALERT_WEBHOOK_URL` configur√© (Slack, Discord, etc.)\n- **Google Cloud Monitoring** : Si SDK configur√©\n\n## üìä Monitoring et M√©triques\n\n### M√©triques Track√©es\n\n1. **Pr√©dictions**\n   - Nombre total\n   - Taux de succ√®s\n   - Temps de r√©ponse\n   - Confiance moyenne\n\n2. **Erreurs**\n   - Nombre d'erreurs par type\n   - Erreurs r√©centes (5 derni√®res minutes)\n   - Taux d'erreur\n\n3. **Performance**\n   - Temps de r√©ponse API\n   - Temps de chargement du mod√®le\n   - Temps de pr√©diction\n\n4. **Utilisateurs**\n   - Actions utilisateur\n   - Feedback (correct/incorrect)\n   - Patterns d'utilisation\n\n### R√©cup√©ration des Statistiques\n\n```typescript\n// GET /api/logging\nconst response = await fetch('/api/logging')\nconst stats = await response.json()\n\nconsole.log(stats)\n// {\n//   recentErrorCount: 2,\n//   alertThreshold: 3,\n//   timeWindowMinutes: 5,\n//   projectId: 'air-paradis-sentiment',\n//   recentErrors: [...],\n//   systemStatus: { ... }\n// }\n```\n\n## üß™ Tests\n\n### Lancer les Tests de Logging\n\n```typescript\n// Dans la console du navigateur\nimport { runLoggingTests } from '@/lib/test-logging'\nrunLoggingTests()\n\n// Ou directement\nwindow.testLogging()\n```\n\n### Tests Inclus\n\n1. **Niveaux de logging** : DEBUG, INFO, WARNING, ERROR, CRITICAL\n2. **Logs sp√©cialis√©s** : Pr√©dictions, performance, erreurs\n3. **D√©clenchement d'alerte** : 3 erreurs rapides\n4. **Test de stress** : Beaucoup de logs simultan√©s\n5. **R√©cup√©ration de statistiques** : API de m√©triques\n\n## üîç Debugging\n\n### Logs en D√©veloppement\n\n```typescript\n// Les logs sont visibles dans la console du navigateur\nconsole.log('[DEBUG] Message de debug')\nconsole.info('[INFO] Information')\nconsole.warn('[WARNING] Avertissement')\nconsole.error('[ERROR] Erreur')\n```\n\n### Logs en Production\n\n```bash\n# Logs Google Cloud Run\ngcloud logs read \"resource.type=cloud_run_revision\" --limit=50\n\n# Logs sp√©cifiques √† l'application\ngcloud logs read \"resource.type=cloud_run_revision AND jsonPayload.source=air-paradis-frontend\"\n```\n\n### D√©sactiver le Logging\n\n```bash\n# Dans .env.local\nNEXT_PUBLIC_MONITORING_ENABLED=false\n```\n\n## üìã Bonnes Pratiques\n\n### ‚úÖ √Ä Faire\n\n- Utiliser les niveaux appropri√©s (DEBUG < INFO < WARNING < ERROR < CRITICAL)\n- Inclure des informations contextuelles utiles\n- Utiliser les m√©thodes sp√©cialis√©es pour les √©v√©nements sp√©cifiques\n- Tester les alertes en d√©veloppement\n- Monitorer les m√©triques de performance\n\n### ‚ùå √Ä √âviter\n\n- Logger des informations sensibles (mots de passe, tokens)\n- Spam de logs (trop de logs peu utiles)\n- Ignorer les erreurs critiques\n- Utiliser le mauvais niveau de log\n- Oublier de tester les alertes\n\n## üîó Int√©grations\n\n### Google Cloud Logging\n\n```typescript\n// Configuration automatique via variables d'environnement\n// Pas de configuration manuelle requise\n```\n\n### Slack/Discord Webhook\n\n```bash\n# .env.local\nALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL\n```\n\n### MLflow Integration\n\n```typescript\n// Les logs sont automatiquement envoy√©s vers MLflow\n// si disponible dans l'environnement\n```\n\n## üÜò Troubleshooting\n\n### Probl√®mes Courants\n\n1. **Logs non visibles**\n   - V√©rifier `NEXT_PUBLIC_MONITORING_ENABLED=true`\n   - V√©rifier la console du navigateur\n\n2. **Alertes non d√©clench√©es**\n   - V√©rifier la configuration des seuils\n   - V√©rifier l'email/webhook configur√©\n\n3. **Erreurs de connexion**\n   - V√©rifier `NEXT_PUBLIC_API_URL`\n   - V√©rifier la connectivit√© √† l'API backend\n\n4. **Performance d√©grad√©e**\n   - R√©duire la fr√©quence des logs\n   - Optimiser les donn√©es logg√©es\n\n### Support\n\nPour toute question ou probl√®me :\n- üìß Email : berchet.thomas@gmail.com\n- üêõ Issues : GitHub repository\n- üìñ Documentation : README.md\n\n---\n\n**Note** : Ce syst√®me de logging est con√ßu pour √™tre robuste et ne pas impacter les performances de l'application, m√™me en cas de panne du syst√®me de monitoring externe.\n